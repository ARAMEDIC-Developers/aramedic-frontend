<%- include('../_partials/header') %>
<div class="dashboard-container">
    <%- include('../_partials/sidebar') %>

    <!-- Contenido Principal -->
    <main id="main-content">
        <%- include('../_partials/sub_header') %>

        <!-- Lista de Notificaciones -->
        <%- include('../_partials/notificaciones') %>

        <!-- Sección de Usuarios -->
        <section id="usuarios">
            <h2 class="section-title">Listado de Usuarios</h2>

            <div style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <input type="text" id="buscar-dni" placeholder="DNI" style="padding: 10px; border: 1px solid #ced4da; border-radius: 4px; width: 150px; margin-right: 10px;"/>
                <input type="text" id="buscar-nombre" placeholder="Nombres" style="padding: 10px; border: 1px solid #ced4da; border-radius: 4px; width: 150px; margin-right: 10px;"/>
                <button id="buscar-btn" style="padding: 10px 15px; background-color: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer;">Buscar</button>
            </div>

            <!-- Formulario para agregar o editar un usuario -->
            <div style="background-color: #e9ecef; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3 id="form-title">Agregar Nuevo Usuario</h3>
                <input type="text" id="nuevo-dni" placeholder="DNI" style="padding: 10px; margin-right: 10px;"/>
                <input type="text" id="nuevo-nombres" placeholder="Nombres" style="padding: 10px; margin-right: 10px;"/>
                <input type="text" id="nuevo-apellidos" placeholder="Apellidos" style="padding: 10px; margin-right: 10px;"/>
                <input type="text" id="nuevo-rol" placeholder="Rol" style="padding: 10px; margin-right: 10px;"/>
                <input type="date" id="nuevo-fecha-nacimiento" placeholder="Fecha de Nacimiento" style="padding: 10px; margin-right: 10px;"/>
                <input type="text" id="nuevo-telefono" placeholder="Número telefónico" style="padding: 10px; margin-right: 10px;"/>
                <select id="nuevo-genero" style="padding: 10px; margin-right: 10px;">
                    <option value="Masculino">Masculino</option>
                    <option value="Femenino">Femenino</option>
                </select>
                <button id="agregar-btn" style="padding: 10px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Agregar Usuario</button>
            </div>

            <table id="usuarios-table" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                <thead style="background-color: #007BFF; color: white;">
                    <tr>
                        <th style="padding: 10px; text-align: left;">ID Usuario</th>
                        <th style="padding: 10px; text-align: left;">DNI</th>
                        <th style="padding: 10px; text-align: left;">Nombres</th>
                        <th style="padding: 10px; text-align: left;">Apellidos</th>
                        <th style="padding: 10px; text-align: left;">Rol</th>
                        <th style="padding: 10px; text-align: left;">Fecha de Nacimiento</th>
                        <th style="padding: 10px; text-align: left;">Número telefónico</th>
                        <th style="padding: 10px; text-align: left;">Género</th>
                        <th style="padding: 10px; text-align: left;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Las filas de usuarios se generarán dinámicamente con JavaScript -->
                </tbody>
            </table>
        </section>
    </main>
</div>

<script>
    let usuarios = [
        { id: 1, dni: "74972730", nombres: "Gabriel Antonio", apellidos: "Castaneda Luyo", rol: "Paciente", fechaNacimiento: "2004-12-11", telefono: "953059465", genero: "Masculino" },
        { id: 2, dni: "72095950", nombres: "Amanda Mariana", apellidos: "Obregon Rodriguez", rol: "Paciente", fechaNacimiento: "1994-11-30", telefono: "958644243", genero: "Femenino" },
        { id: 3, dni: "47454844", nombres: "Roberto Jesus", apellidos: "Rial Palacios", rol: "Paciente", fechaNacimiento: "1989-02-16", telefono: "986276957", genero: "Masculino" },
        { id: 4, dni: "62346304", nombres: "Juan Daniel", apellidos: "Pallares Cerdan", rol: "Paciente", fechaNacimiento: "2001-02-26", telefono: "996473615", genero: "Masculino" },
        { id: 5, dni: "19205415", nombres: "María Elisa", apellidos: "Fidalgo Armas", rol: "Paciente", fechaNacimiento: "1998-04-21", telefono: "968498097", genero: "Femenino" }
    ];

    let usuarioSeleccionado = null;

    // Función para renderizar la tabla
    function renderTable(filtrar = false) {
        const tableBody = document.querySelector("#usuarios-table tbody");
        tableBody.innerHTML = ""; // Limpiar la tabla

        let usuariosFiltrados = usuarios;

        // Si se activa el filtro (búsqueda)
        if (filtrar) {
            const dniBuscar = document.getElementById('buscar-dni').value;
            const nombreBuscar = document.getElementById('buscar-nombre').value;

            usuariosFiltrados = usuarios.filter(usuario => {
                return (
                    (!dniBuscar || usuario.dni.includes(dniBuscar)) &&
                    (!nombreBuscar || usuario.nombres.toLowerCase().includes(nombreBuscar.toLowerCase()))
                );
            });
        }

        usuariosFiltrados.forEach(usuario => {
            const row = `
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 10px;">${usuario.id}</td>
                    <td style="padding: 10px;">${usuario.dni}</td>
                    <td style="padding: 10px;">${usuario.nombres}</td>
                    <td style="padding: 10px;">${usuario.apellidos}</td>
                    <td style="padding: 10px;">${usuario.rol}</td>
                    <td style="padding: 10px;">${usuario.fechaNacimiento}</td>
                    <td style="padding: 10px;">${usuario.telefono}</td>
                    <td style="padding: 10px;">${usuario.genero}</td>
                    <td style="padding: 10px;">
                        <button onclick="editarUsuario(${usuario.id})" style="background-color: #28a745; color: white; border: none; padding: 5px 10px; cursor: pointer; margin-right: 5px;">Editar</button>
                        <button onclick="verUsuario(${usuario.id})" style="background-color: #007BFF; color: white; border: none; padding: 5px 10px; cursor: pointer; margin-right: 5px;">Ver</button>
                        <button onclick="eliminarUsuario(${usuario.id})" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; cursor: pointer;">Eliminar</button>
                    </td>
                </tr>
            `;
            tableBody.insertAdjacentHTML('beforeend', row);
        });
    }

    // Función para agregar o editar un usuario
    document.getElementById('agregar-btn').addEventListener('click', function() {
        const dni = document.getElementById('nuevo-dni').value;
        const nombres = document.getElementById('nuevo-nombres').value;
        const apellidos = document.getElementById('nuevo-apellidos').value;
        const rol = document.getElementById('nuevo-rol').value;
        const fechaNacimiento = document.getElementById('nuevo-fecha-nacimiento').value;
        const telefono = document.getElementById('nuevo-telefono').value;
        const genero = document.getElementById('nuevo-genero').value;

        if (usuarioSeleccionado) {
            // Editar usuario
            usuarioSeleccionado.dni = dni;
            usuarioSeleccionado.nombres = nombres;
            usuarioSeleccionado.apellidos = apellidos;
            usuarioSeleccionado.rol = rol;
            usuarioSeleccionado.fechaNacimiento = fechaNacimiento;
            usuarioSeleccionado.telefono = telefono;
            usuarioSeleccionado.genero = genero;
            alert("Usuario actualizado");
            usuarioSeleccionado = null;
        } else {
            // Agregar nuevo usuario
            const nuevoUsuario = {
                id: usuarios.length + 1,
                dni,
                nombres,
                apellidos,
                rol,
                fechaNacimiento,
                telefono,
                genero
            };
            usuarios.push(nuevoUsuario);
            alert("Usuario agregado");
        }

        // Limpiar formulario
        document.getElementById('form-title').innerText = "Agregar Nuevo Usuario";
        document.getElementById('nuevo-dni').value = "";
        document.getElementById('nuevo-nombres').value = "";
        document.getElementById('nuevo-apellidos').value = "";
        document.getElementById('nuevo-rol').value = "";
        document.getElementById('nuevo-fecha-nacimiento').value = "";
        document.getElementById('nuevo-telefono').value = "";
        document.getElementById('nuevo-genero').value = "Masculino";

        renderTable(); // Actualizar la tabla
    });

    // Función para editar un usuario
    function editarUsuario(id) {
        usuarioSeleccionado = usuarios.find(u => u.id === id);
        document.getElementById('form-title').innerText = "Editar Usuario";
        document.getElementById('nuevo-dni').value = usuarioSeleccionado.dni;
        document.getElementById('nuevo-nombres').value = usuarioSeleccionado.nombres;
        document.getElementById('nuevo-apellidos').value = usuarioSeleccionado.apellidos;
        document.getElementById('nuevo-rol').value = usuarioSeleccionado.rol;
        document.getElementById('nuevo-fecha-nacimiento').value = usuarioSeleccionado.fechaNacimiento;
        document.getElementById('nuevo-telefono').value = usuarioSeleccionado.telefono;
        document.getElementById('nuevo-genero').value = usuarioSeleccionado.genero;
    }

    // Función para ver un usuario
    function verUsuario(id) {
        const usuario = usuarios.find(u => u.id === id);
        alert(`Viendo usuario: ${usuario.nombres} ${usuario.apellidos}`);
    }

    // Función para eliminar un usuario
    function eliminarUsuario(id) {
        usuarios = usuarios.filter(u => u.id !== id);
        alert(`Usuario eliminado`);
        renderTable(); // Volver a renderizar la tabla después de eliminar
    }

    // Función de búsqueda
    document.getElementById('buscar-btn').addEventListener('click', function() {
        renderTable(true); // Filtrar la tabla al buscar
    });

    // Inicializar la tabla al cargar la página
    document.addEventListener("DOMContentLoaded", renderTable);
</script>

<%- include('../_partials/footer') %>

